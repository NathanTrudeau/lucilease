<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lucilease</title>
  <style>
    :root {
      --bg:       #0f1117;
      --surface:  #1a1d27;
      --border:   #2a2d3a;
      --accent:   #6c63ff;
      --accent2:  #a78bfa;
      --text:     #e2e8f0;
      --muted:    #64748b;
      --green:    #22c55e;
      --yellow:   #f59e0b;
      --red:      #ef4444;
      --sidebar-w: 220px;
    }

    /* â”€â”€ Theme swatches â”€â”€ */
    .color-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 8px;
    }
    .swatch {
      width: 100%; aspect-ratio: 1;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: transform 0.15s, border-color 0.15s;
    }
    .swatch:hover { transform: scale(1.1); }
    .swatch.selected { border-color: var(--text); }

    /* â”€â”€ Signature toolbar â”€â”€ */
    .sig-toolbar {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .sig-toolbar button {
      background: var(--border);
      color: var(--text);
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 5px;
      min-width: unset;
    }
    .sig-toolbar select {
      background: var(--border);
      color: var(--text);
      border: none;
      border-radius: 5px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
    }
    .sig-editor {
      min-height: 80px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--text);
      outline: none;
      line-height: 1.5;
    }
    .sig-editor:focus { border-color: var(--accent); }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      height: 100vh;
      overflow: hidden;
      font-size: 14px;
    }

    /* â”€â”€ Sidebar â”€â”€ */
    aside {
      width: var(--sidebar-w);
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .logo { padding: 24px 20px 20px; border-bottom: 1px solid var(--border); }
    .logo h1 { font-size: 20px; font-weight: 700; color: var(--accent2); letter-spacing: -0.5px; }
    .logo p  { font-size: 11px; color: var(--muted); margin-top: 2px; }

    nav { padding: 12px 8px; flex: 1; }

    nav a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 12px;
      border-radius: 8px;
      color: var(--muted);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 2px;
    }

    nav a:hover { background: var(--border); color: var(--text); }
    nav a.active { background: rgba(108, 99, 255, 0.15); color: var(--accent2); }
    nav a .icon { font-size: 16px; width: 20px; text-align: center; }

    .badge {
      margin-left: auto;
      background: var(--accent);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      padding: 1px 6px;
      border-radius: 20px;
      min-width: 18px;
      text-align: center;
    }
    .badge.zero { background: var(--border); color: var(--muted); }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
      font-size: 11px;
      color: var(--muted);
    }

    .status-dot {
      display: inline-block;
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--green);
      margin-right: 6px;
      animation: pulse 2s infinite;
    }
    .status-dot.offline { background: var(--red); animation: none; }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

    /* â”€â”€ Main â”€â”€ */
    main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

    header {
      padding: 18px 28px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
      flex-shrink: 0;
    }

    header h2 { font-size: 16px; font-weight: 600; }
    header p  { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .header-actions { display: flex; gap: 10px; align-items: center; }

    /* â”€â”€ Buttons â”€â”€ */
    button, .btn {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 7px 14px;
      border-radius: 7px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: opacity 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
    }
    button:hover, .btn:hover { opacity: 0.85; }
    button.secondary, .btn.secondary { background: var(--border); color: var(--text); }
    button.danger { background: rgba(239,68,68,0.15); color: var(--red); }
    button.success { background: rgba(34,197,94,0.15); color: var(--green); }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    /* â”€â”€ Content â”€â”€ */
    .content { flex: 1; overflow-y: auto; padding: 28px; }

    /* â”€â”€ Stats â”€â”€ */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 18px 20px;
    }
    .stat-card .label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card .value { font-size: 28px; font-weight: 700; margin-top: 6px; }
    .stat-card .sub   { font-size: 11px; color: var(--muted); margin-top: 4px; }

    /* â”€â”€ Alert banner â”€â”€ */
    .banner {
      border-radius: 10px;
      padding: 14px 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }
    .banner.warn  { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); color: var(--yellow); }
    .banner.info  { background: rgba(108,99,255,0.1); border: 1px solid rgba(108,99,255,0.3); color: var(--accent2); }
    .banner.good  { background: rgba(34,197,94,0.1);  border: 1px solid rgba(34,197,94,0.3);  color: var(--green); }
    .banner a { color: inherit; font-weight: 600; }

    /* â”€â”€ Panel â”€â”€ */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .panel-header {
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      font-weight: 600;
    }

    /* â”€â”€ Table â”€â”€ */
    table { width: 100%; border-collapse: collapse; }
    th {
      text-align: left;
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 10px 20px;
      border-bottom: 1px solid var(--border);
    }
    td {
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      vertical-align: middle;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(255,255,255,0.02); }

    .tag {
      display: inline-block;
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .tag.new     { background: rgba(108,99,255,0.2); color: var(--accent2); }
    .tag.handled { background: rgba(34,197,94,0.15); color: var(--green); }
    .tag.active  { background: rgba(34,197,94,0.15); color: var(--green); }
    .tag.rental  { background: rgba(245,158,11,0.15); color: var(--yellow); }
    .tag.sale    { background: rgba(239,68,68,0.15); color: var(--red); }

    .actions { display: flex; gap: 6px; flex-wrap: wrap; }

    /* â”€â”€ Empty state â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 48px 20px;
      color: var(--muted);
    }
    .empty-state .icon { font-size: 36px; margin-bottom: 12px; }
    .empty-state p { font-size: 13px; }

    /* â”€â”€ Settings form â”€â”€ */
    .settings-section { margin-bottom: 28px; }
    .settings-section h3 { font-size: 14px; font-weight: 600; margin-bottom: 16px; color: var(--text); }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
    }
    .setting-row:last-child { border-bottom: none; }
    .setting-label { font-size: 13px; font-weight: 500; }
    .setting-desc  { font-size: 11px; color: var(--muted); margin-top: 2px; }

    /* â”€â”€ Page visibility â”€â”€ */
    .page { display: none; flex-direction: column; height: 100%; overflow: hidden; }
    .page.active { display: flex; }

    /* â”€â”€ Modal â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 28px;
      width: 480px;
      max-width: 95vw;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h3 { font-size: 15px; font-weight: 600; margin-bottom: 20px; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 24px; }

    /* â”€â”€ Form â”€â”€ */
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 12px; font-weight: 500; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.4px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 9px 12px;
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 7px; color: var(--text); font-size: 13px;
      outline: none; transition: border-color 0.15s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: var(--accent);
    }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    /* â”€â”€ Toggle switch â”€â”€ */
    .toggle-track {
      width: 36px; height: 20px;
      background: var(--border);
      border-radius: 20px;
      position: relative;
      transition: background 0.2s;
      cursor: pointer;
    }
    .toggle-track.on { background: var(--accent); }
    .toggle-thumb {
      width: 14px; height: 14px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: 3px; left: 3px;
      transition: left 0.2s;
    }
    .toggle-track.on .toggle-thumb { left: 19px; }

    /* â”€â”€ Draft preview â”€â”€ */
    .draft-preview {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
      color: var(--text);
    }
  </style>
</head>
<body>

<!-- Sidebar -->
<aside>
  <div class="logo">
    <h1>Lucilease</h1>
    <p>Real Estate AI Assistant</p>
  </div>

  <nav>
    <a class="active" onclick="showPage('dashboard', this)">
      <span class="icon">ğŸ </span> Dashboard
    </a>
    <a onclick="showPage('inbox', this)">
      <span class="icon">ğŸ“¬</span> Inbox
      <span class="badge zero" id="inbox-badge">0</span>
    </a>
    <a onclick="showPage('clients', this)">
      <span class="icon">ğŸ‘¥</span> Clients
    </a>
    <a onclick="showPage('properties', this)">
      <span class="icon">ğŸ¢</span> Properties
    </a>
    <a onclick="showPage('calendar', this)">
      <span class="icon">ğŸ“…</span> Calendar
    </a>
    <a onclick="showPage('settings', this)">
      <span class="icon">âš™ï¸</span> Settings
    </a>
  </nav>

  <div class="sidebar-footer">
    <span class="status-dot" id="status-dot"></span>
    <span id="status-text">Checking...</span>
  </div>
</aside>

<!-- â”€â”€ Draft Modal â”€â”€ -->
<div class="modal-overlay" id="draft-modal">
  <div class="modal" style="width:560px">
    <h3>âœ Draft Reply</h3>
    <div id="draft-modal-content">
      <p style="color:var(--muted);text-align:center;padding:20px">Generating with Claude...</p>
    </div>
    <div class="modal-footer">
      <button class="secondary" onclick="closeModal('draft-modal')">Close</button>
      <a id="draft-gmail-link" class="btn" href="#" target="_blank" style="display:none">Open in Gmail â†’</a>
    </div>
  </div>
</div>

<!-- â”€â”€ Add Property Modal â”€â”€ -->
<div class="modal-overlay" id="property-modal">
  <div class="modal">
    <h3>ğŸ¢ Add Property</h3>
    <div class="form-group">
      <label>Address</label>
      <input id="prop-address" type="text" placeholder="123 Main St, Santa Barbara, CA" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Type</label>
        <select id="prop-type">
          <option value="rental">Rental</option>
          <option value="sale">For Sale</option>
        </select>
      </div>
      <div class="form-group" id="prop-price-group">
        <label>Monthly Rent ($)</label>
        <input id="prop-price-monthly" type="number" placeholder="3500" />
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Bedrooms</label>
        <input id="prop-bedrooms" type="number" placeholder="2" />
      </div>
      <div class="form-group">
        <label>Bathrooms</label>
        <input id="prop-bathrooms" type="number" step="0.5" placeholder="1.5" />
      </div>
    </div>
    <div class="form-group">
      <label>Notes</label>
      <textarea id="prop-notes" placeholder="Pet-friendly, parking included, near downtown..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="secondary" onclick="closeModal('property-modal')">Cancel</button>
      <button onclick="submitProperty()">Add Property</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Agent Profile Modal â”€â”€ -->
<div class="modal-overlay" id="profile-modal">
  <div class="modal" style="width:520px">
    <h3>ğŸ‘¤ Agent Profile</h3>
    <div class="form-row">
      <div class="form-group">
        <label>Your Name</label>
        <input id="profile-name" type="text" placeholder="Jane Smith" />
      </div>
      <div class="form-group">
        <label>Company</label>
        <input id="profile-company" type="text" placeholder="Santa Barbara Realty" />
      </div>
    </div>
    <div class="form-group">
      <label>Reply Tone</label>
      <select id="profile-tone">
        <option value="professional and warm">Professional &amp; Warm</option>
        <option value="friendly and conversational">Friendly &amp; Conversational</option>
        <option value="concise and direct">Concise &amp; Direct</option>
        <option value="formal and corporate">Formal &amp; Corporate</option>
      </select>
    </div>
    <div class="form-group">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
        <label style="margin:0">Custom Signature</label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;text-transform:none;letter-spacing:0;font-size:12px;color:var(--muted)">
          <span id="sig-toggle-label">Off</span>
          <div class="toggle-wrap" onclick="toggleSig()">
            <input type="checkbox" id="sig-enabled" style="display:none" />
            <div class="toggle-track" id="sig-track">
              <div class="toggle-thumb" id="sig-thumb"></div>
            </div>
          </div>
        </label>
      </div>
      <div id="sig-editor-wrap" style="display:none">
      <div class="sig-toolbar">
        <button type="button" onclick="sigFmt('bold')"><b>B</b></button>
        <button type="button" onclick="sigFmt('italic')"><i>I</i></button>
        <button type="button" onclick="sigFmt('underline')"><u>U</u></button>
        <select onchange="sigFmt('fontSize', this.value); this.value=''">
          <option value="">Size</option>
          <option value="1">Small</option>
          <option value="3">Normal</option>
          <option value="4">Large</option>
          <option value="5">X-Large</option>
        </select>
        <select onchange="sigFmt('fontName', this.value); this.value=''">
          <option value="">Font</option>
          <option value="Arial">Arial</option>
          <option value="Georgia">Georgia</option>
          <option value="Helvetica">Helvetica</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Courier New">Courier New</option>
        </select>
      </div>
      <div id="sig-editor" class="sig-editor" contenteditable="true"
           placeholder="e.g. Jane Smith | Santa Barbara Realty | (805) 555-0100"></div>
      </div><!-- /sig-editor-wrap -->
    </div>
    <div class="modal-footer">
      <button class="secondary" onclick="closeModal('profile-modal')">Cancel</button>
      <button onclick="saveProfile()">Save Profile</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Theme Picker Modal â”€â”€ -->
<div class="modal-overlay" id="theme-modal">
  <div class="modal" style="width:360px">
    <h3>ğŸ¨ Theme Color</h3>
    <p style="font-size:12px;color:var(--muted);margin-bottom:16px">Choose an accent color for the interface.</p>
    <p style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px">Soft</p>
    <div class="color-grid" id="soft-swatches"></div>
    <p style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;margin:16px 0 8px">Vivid</p>
    <div class="color-grid" id="vivid-swatches"></div>
    <div class="modal-footer">
      <button class="secondary" onclick="closeModal('theme-modal')">Done</button>
    </div>
  </div>
</div>

<!-- Main -->
<main>

  <!-- â”€â”€ Dashboard â”€â”€ -->
  <div id="page-dashboard" class="page active">
    <header>
      <div>
        <h2>Dashboard</h2>
        <p id="header-date">â€”</p>
      </div>
      <div class="header-actions">
        <button class="secondary" onclick="refreshAll()">â†» Refresh</button>
      </div>
    </header>
    <div class="content">

      <div id="gmail-banner"></div>

      <div class="stats">
        <div class="stat-card">
          <div class="label">New Leads</div>
          <div class="value" id="stat-leads-new">â€”</div>
          <div class="sub">Awaiting review</div>
        </div>
        <div class="stat-card">
          <div class="label">Total Leads</div>
          <div class="value" id="stat-leads-total">â€”</div>
          <div class="sub">All time</div>
        </div>
        <div class="stat-card">
          <div class="label">Clients</div>
          <div class="value" id="stat-clients">â€”</div>
          <div class="sub">Active contacts</div>
        </div>
        <div class="stat-card">
          <div class="label">Properties</div>
          <div class="value" id="stat-properties">â€”</div>
          <div class="sub">Active listings</div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          Recent Leads
          <button class="secondary" onclick="showPage('inbox', document.querySelector('nav a:nth-child(2)'))">View all â†’</button>
        </div>
        <div id="recent-leads-container">
          <div class="empty-state"><div class="icon">ğŸ“­</div><p>No leads yet.</p></div>
        </div>
      </div>

    </div>
  </div>

  <!-- â”€â”€ Inbox â”€â”€ -->
  <div id="page-inbox" class="page">
    <header>
      <div>
        <h2>Inbox</h2>
        <p>Incoming lead emails</p>
      </div>
      <div class="header-actions">
        <button class="secondary" onclick="manualPoll()" id="poll-btn">â†» Check now</button>
      </div>
    </header>
    <div class="content">
      <div class="panel">
        <div class="panel-header">
          New Leads
          <span id="leads-count" style="color:var(--muted);font-weight:400;font-size:12px;"></span>
        </div>
        <div id="leads-container">
          <div class="empty-state"><div class="icon">ğŸ“¬</div><p>Loading...</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Clients â”€â”€ -->
  <div id="page-clients" class="page">
    <header>
      <div><h2>Clients</h2><p>Your contact list</p></div>
      <div class="header-actions"><button>+ Add Client</button></div>
    </header>
    <div class="content">
      <div class="panel">
        <div class="panel-header">All Clients</div>
        <div id="clients-container">
          <div class="empty-state"><div class="icon">ğŸ‘¥</div><p>No clients yet.</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Properties â”€â”€ -->
  <div id="page-properties" class="page">
    <header>
      <div><h2>Properties</h2><p>Your active listings</p></div>
      <div class="header-actions"><button onclick="openModal('property-modal')">+ Add Property</button></div>
    </header>
    <div class="content">
      <div class="panel">
        <div class="panel-header">Active Listings</div>
        <div id="properties-container">
          <div class="empty-state"><div class="icon">ğŸ¢</div><p>No properties yet.</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Calendar â”€â”€ -->
  <div id="page-calendar" class="page">
    <header><div><h2>Calendar</h2><p>Upcoming appointments</p></div></header>
    <div class="content">
      <div class="panel">
        <div class="empty-state"><div class="icon">ğŸ“…</div><p>Google Calendar integration â€” coming in Phase 4.</p></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Settings â”€â”€ -->
  <div id="page-settings" class="page">
    <header><div><h2>Settings</h2><p>Configure your Lucilease agent</p></div></header>
    <div class="content">

      <div class="panel settings-section">
        <div class="panel-header">Gmail Connection</div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Connected Account</div>
            <div class="setting-desc" id="gmail-account-display">Checking...</div>
          </div>
          <div id="gmail-connect-btn">
            <button class="secondary" disabled>...</button>
          </div>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Poll Interval</div>
            <div class="setting-desc">How often Lucilease checks for new emails</div>
          </div>
          <div style="color:var(--muted);font-size:13px;" id="poll-interval-display">â€”</div>
        </div>
      </div>

      <div class="panel settings-section">
        <div class="panel-header">Agent &amp; AI</div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Agent Profile</div>
            <div class="setting-desc">Your name, company, tone, and email signature</div>
          </div>
          <button onclick="openProfileModal()">Edit Profile</button>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Google Calendar</div>
            <div class="setting-desc">Connect to schedule appointments from emails</div>
          </div>
          <button class="secondary" disabled>Phase 4</button>
        </div>
      </div>

      <div class="panel settings-section">
        <div class="panel-header">Appearance</div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Theme Color</div>
            <div class="setting-desc">Customize the accent color of the interface</div>
          </div>
          <button onclick="openModal('theme-modal')">ğŸ¨ Change Color</button>
        </div>
      </div>

    </div>
  </div>

</main>

<script>
  // â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showPage(name, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    document.getElementById('page-' + name).classList.add('active');
    if (el) el.classList.add('active');
    if (name === 'inbox')    loadLeads();
    if (name === 'clients')  loadClients();
    if (name === 'properties') loadProperties();
  }

  // â”€â”€ Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SOFT_COLORS  = [
    { name: 'Lavender', accent: '#c4b5fd', accent2: '#ddd6fe' },
    { name: 'Sky',      accent: '#93c5fd', accent2: '#bfdbfe' },
    { name: 'Mint',     accent: '#6ee7b7', accent2: '#a7f3d0' },
    { name: 'Peach',    accent: '#fca5a5', accent2: '#fecaca' },
    { name: 'Rose',     accent: '#f9a8d4', accent2: '#fbcfe8' },
  ];
  const VIVID_COLORS = [
    { name: 'Purple',   accent: '#6c63ff', accent2: '#a78bfa' },
    { name: 'Blue',     accent: '#2563eb', accent2: '#60a5fa' },
    { name: 'Emerald',  accent: '#059669', accent2: '#34d399' },
    { name: 'Coral',    accent: '#e11d48', accent2: '#fb7185' },
    { name: 'Teal',     accent: '#0891b2', accent2: '#22d3ee' },
  ];

  function applyTheme(accent, accent2) {
    document.documentElement.style.setProperty('--accent', accent);
    document.documentElement.style.setProperty('--accent2', accent2);
    localStorage.setItem('ll-accent',  accent);
    localStorage.setItem('ll-accent2', accent2);
  }

  function buildSwatches() {
    const selected = localStorage.getItem('ll-accent') || '#6c63ff';

    function renderGroup(colors, containerId) {
      const el = document.getElementById(containerId);
      el.innerHTML = '';
      colors.forEach(c => {
        const s = document.createElement('div');
        s.className = 'swatch' + (c.accent === selected ? ' selected' : '');
        s.style.background = c.accent;
        s.title = c.name;
        s.onclick = () => {
          document.querySelectorAll('.swatch').forEach(x => x.classList.remove('selected'));
          s.classList.add('selected');
          applyTheme(c.accent, c.accent2);
        };
        el.appendChild(s);
      });
    }
    renderGroup(SOFT_COLORS,  'soft-swatches');
    renderGroup(VIVID_COLORS, 'vivid-swatches');
  }

  // Apply saved theme on load
  const savedAccent  = localStorage.getItem('ll-accent');
  const savedAccent2 = localStorage.getItem('ll-accent2');
  if (savedAccent && savedAccent2) applyTheme(savedAccent, savedAccent2);

  // â”€â”€ Auth status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let isAuthed = false;

  async function checkAuth() {
    try {
      const r = await fetch('/auth/status');
      const d = await r.json();
      isAuthed = d.authenticated;

      const dot    = document.getElementById('status-dot');
      const text   = document.getElementById('status-text');
      const btn    = document.getElementById('gmail-connect-btn');
      const banner = document.getElementById('gmail-banner');
      const acctEl = document.getElementById('gmail-account-display');

      if (isAuthed) {
        dot.className    = 'status-dot';
        text.textContent = 'Gmail connected';
        btn.innerHTML    = `<button class="danger" onclick="disconnectGmail()">Disconnect</button>
                            <a class="btn secondary" href="/auth/gmail" style="margin-left:8px">Swap account</a>`;
        banner.innerHTML = '';
        // Fetch account email
        const ar = await fetch('/api/gmail-account');
        const ad = await ar.json();
        if (ad.email) acctEl.textContent = ad.email;
      } else {
        dot.className    = 'status-dot offline';
        text.textContent = 'Gmail not connected';
        btn.innerHTML    = '<a class="btn" href="/auth/gmail">Connect Gmail â†’</a>';
        if (acctEl) acctEl.textContent = 'Not connected';
        banner.innerHTML = `
          <div class="banner warn">
            âš ï¸ Gmail is not connected.
            <a href="/auth/gmail">Connect now</a> to start receiving leads.
          </div>`;
      }
    } catch(e) {
      console.error('Auth check failed', e);
    }
  }

  async function disconnectGmail() {
    if (!confirm('Disconnect Gmail? Lucilease will stop checking for new leads until reconnected.')) return;
    await fetch('/auth/gmail', { method: 'DELETE' });
    await checkAuth();
  }

  // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function refreshStats() {
    try {
      const r = await fetch('/api/stats');
      const d = await r.json();
      document.getElementById('stat-leads-new').textContent   = d.leads_new;
      document.getElementById('stat-leads-total').textContent = d.leads_total;
      document.getElementById('stat-clients').textContent     = d.clients;
      document.getElementById('stat-properties').textContent  = d.properties;

      const badge = document.getElementById('inbox-badge');
      badge.textContent = d.leads_new;
      badge.className   = 'badge' + (d.leads_new > 0 ? '' : ' zero');
    } catch(e) { console.error('Stats failed', e); }
  }

  // â”€â”€ Leads â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadLeads() {
    const container = document.getElementById('leads-container');
    try {
      const r = await fetch('/api/leads?status=new');
      const leads = await r.json();

      document.getElementById('leads-count').textContent =
        leads.length ? `${leads.length} new` : '';

      if (!leads.length) {
        container.innerHTML = `<div class="empty-state">
          <div class="icon">ğŸ“­</div>
          <p>${isAuthed ? 'No new leads. Inbox is clear.' : 'Connect Gmail in Settings to start.'}</p>
        </div>`;
        return;
      }

      container.innerHTML = `
        <table>
          <thead><tr>
            <th>Name</th><th>Email</th><th>Phone</th>
            <th>Subject</th><th>Budget</th><th>Received</th><th>Actions</th>
          </tr></thead>
          <tbody>
            ${leads.map(l => `
              <tr id="lead-row-${l.id}">
                <td>${l.name || 'â€”'}</td>
                <td><a href="mailto:${l.from_email}" style="color:var(--accent2)">${l.from_email}</a></td>
                <td>${l.phone || 'â€”'}</td>
                <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${l.subject || 'â€”'}</td>
                <td>${l.budget_monthly_usd ? '$' + l.budget_monthly_usd.toLocaleString() + '/mo' : 'â€”'}</td>
                <td style="color:var(--muted);font-size:12px">${formatDate(l.first_seen_at)}</td>
                <td>
                  <div class="actions">
                    <button onclick="generateDraft(${l.id}, this)">âœ Draft</button>
                    <button class="success" onclick="addClient(${l.id})">+ Client</button>
                    <button class="danger" onclick="handleLead(${l.id})">âœ“ Done</button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>`;

      // Also update dashboard recent leads
      updateRecentLeads(leads.slice(0, 5));
    } catch(e) {
      container.innerHTML = `<div class="empty-state"><div class="icon">âš ï¸</div><p>Failed to load leads.</p></div>`;
    }
  }

  function updateRecentLeads(leads) {
    const el = document.getElementById('recent-leads-container');
    if (!leads.length) {
      el.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“­</div><p>No leads yet.</p></div>`;
      return;
    }
    el.innerHTML = `
      <table>
        <thead><tr><th>Name</th><th>Email</th><th>Subject</th><th>Budget</th><th>Received</th></tr></thead>
        <tbody>
          ${leads.map(l => `
            <tr>
              <td>${l.name || 'â€”'}</td>
              <td style="color:var(--accent2)">${l.from_email}</td>
              <td>${l.subject || 'â€”'}</td>
              <td>${l.budget_monthly_usd ? '$' + l.budget_monthly_usd.toLocaleString() + '/mo' : 'â€”'}</td>
              <td style="color:var(--muted);font-size:12px">${formatDate(l.first_seen_at)}</td>
            </tr>`).join('')}
        </tbody>
      </table>`;
  }

  async function handleLead(id) {
    await fetch(`/api/leads/${id}/handle`, { method: 'POST' });
    document.getElementById(`lead-row-${id}`)?.remove();
    refreshStats();
  }

  async function addClient(id) {
    const r = await fetch(`/api/leads/${id}/add-client`, { method: 'POST' });
    const d = await r.json();
    if (d.ok) {
      alert('Client added!');
      refreshStats();
    }
  }

  async function manualPoll() {
    const btn = document.getElementById('poll-btn');
    btn.disabled = true;
    btn.textContent = 'Checking...';
    try {
      const r = await fetch('/api/poll', { method: 'POST' });
      const d = await r.json();
      btn.textContent = `â†» Check now (${d.new_leads} new)`;
      await loadLeads();
      await refreshStats();
    } catch(e) {
      btn.textContent = 'â†» Check now';
    }
    btn.disabled = false;
  }

  // â”€â”€ Clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadClients() {
    const container = document.getElementById('clients-container');
    try {
      const r = await fetch('/api/clients');
      const clients = await r.json();
      if (!clients.length) {
        container.innerHTML = `<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>No clients yet.</p></div>`;
        return;
      }
      container.innerHTML = `
        <table>
          <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Status</th><th>Added</th><th></th></tr></thead>
          <tbody>
            ${clients.map(c => `
              <tr id="client-row-${c.id}">
                <td>${c.name}</td>
                <td><a href="mailto:${c.email}" style="color:var(--accent2)">${c.email || 'â€”'}</a></td>
                <td>${c.phone || 'â€”'}</td>
                <td><span class="tag active">${c.status}</span></td>
                <td style="color:var(--muted);font-size:12px">${formatDate(c.created_at)}</td>
                <td><button class="danger" onclick="deleteClient(${c.id}, '${c.name.replace(/'/g,"\\'")}')">Remove</button></td>
              </tr>`).join('')}
          </tbody>
        </table>`;
    } catch(e) {
      container.innerHTML = `<div class="empty-state"><div class="icon">âš ï¸</div><p>Failed to load.</p></div>`;
    }
  }

  // â”€â”€ Properties â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadProperties() {
    const container = document.getElementById('properties-container');
    try {
      const r = await fetch('/api/properties');
      const props = await r.json();
      if (!props.length) {
        container.innerHTML = `<div class="empty-state"><div class="icon">ğŸ¢</div><p>No properties yet.</p></div>`;
        return;
      }
      container.innerHTML = `
        <table>
          <thead><tr><th>Address</th><th>Type</th><th>Bed/Bath</th><th>Price</th><th>Status</th></tr></thead>
          <tbody>
            ${props.map(p => `
              <tr>
                <td>${p.address}</td>
                <td><span class="tag ${p.type}">${p.type}</span></td>
                <td>${p.bedrooms || 'â€”'} bd / ${p.bathrooms || 'â€”'} ba</td>
                <td>${p.price_monthly ? '$' + p.price_monthly.toLocaleString() + '/mo' :
                     p.price_sale    ? '$' + p.price_sale.toLocaleString() : 'â€”'}</td>
                <td><span class="tag active">${p.status}</span></td>
              </tr>`).join('')}
          </tbody>
        </table>`;
    } catch(e) {
      container.innerHTML = `<div class="empty-state"><div class="icon">âš ï¸</div><p>Failed to load.</p></div>`;
    }
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatDate(iso) {
    if (!iso) return 'â€”';
    return new Date(iso).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
  }

  async function refreshAll() {
    await Promise.all([checkAuth(), refreshStats()]);
  }

  // â”€â”€ Poll interval display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setPollDisplay() {
    const secs = 300; // default, could fetch from /health
    const mins = Math.round(secs / 60);
    document.getElementById('poll-interval-display').textContent =
      mins >= 1 ? `Every ${mins} minute${mins > 1 ? 's' : ''}` : `Every ${secs}s`;
  }

  // â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(id) { document.getElementById(id).classList.add('open'); }
  function closeModal(id) { document.getElementById(id).classList.remove('open'); }

  // Close on backdrop click
  document.querySelectorAll('.modal-overlay').forEach(el => {
    el.addEventListener('click', e => { if (e.target === el) el.classList.remove('open'); });
  });

  // â”€â”€ Draft reply â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function generateDraft(leadId, btn) {
    btn.disabled = true;
    btn.textContent = 'â³ Drafting...';

    document.getElementById('draft-modal-content').innerHTML =
      '<p style="color:var(--muted);text-align:center;padding:20px">Generating with Claude Sonnet...</p>';
    document.getElementById('draft-gmail-link').style.display = 'none';
    openModal('draft-modal');

    try {
      const r = await fetch(`/api/leads/${leadId}/draft`, { method: 'POST' });
      const d = await r.json();

      if (!d.ok) throw new Error(d.error || 'Draft failed');

      document.getElementById('draft-modal-content').innerHTML = `
        <div style="margin-bottom:12px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:4px">Subject</div>
          <div style="font-size:13px;font-weight:500">${d.subject}</div>
        </div>
        <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px">Reply</div>
        <div class="draft-preview">${d.body}</div>
        ${d.gmail_draft_id
          ? '<p style="margin-top:12px;font-size:12px;color:var(--green)">âœ“ Saved to Gmail Drafts</p>'
          : '<p style="margin-top:12px;font-size:12px;color:var(--muted)">Draft saved locally (Gmail draft unavailable)</p>'
        }`;

      if (d.gmail_draft_id) {
        const gmailLink = document.getElementById('draft-gmail-link');
        gmailLink.href = 'https://mail.google.com/mail/#drafts';
        gmailLink.style.display = 'inline-flex';
      }

      btn.textContent = 'âœ“ Drafted';
    } catch(e) {
      document.getElementById('draft-modal-content').innerHTML =
        `<p style="color:var(--red);text-align:center;padding:20px">Error: ${e.message}</p>`;
      btn.disabled = false;
      btn.textContent = 'âœ Draft';
    }
  }

  // â”€â”€ Add Property â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('prop-type').addEventListener('change', function() {
    const label = this.value === 'rental' ? 'Monthly Rent ($)' : 'Sale Price ($)';
    document.querySelector('#prop-price-group label').textContent = label;
    document.getElementById('prop-price-monthly').placeholder =
      this.value === 'rental' ? '3500' : '650000';
  });

  async function submitProperty() {
    const type = document.getElementById('prop-type').value;
    const price = parseInt(document.getElementById('prop-price-monthly').value) || null;

    const body = {
      address:       document.getElementById('prop-address').value.trim(),
      type,
      bedrooms:      parseInt(document.getElementById('prop-bedrooms').value) || null,
      bathrooms:     parseFloat(document.getElementById('prop-bathrooms').value) || null,
      price_monthly: type === 'rental' ? price : null,
      price_sale:    type === 'sale'   ? price : null,
      notes:         document.getElementById('prop-notes').value.trim() || null,
    };

    if (!body.address) { alert('Address is required.'); return; }

    const r = await fetch('/api/properties', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });
    const d = await r.json();
    if (d.ok) {
      closeModal('property-modal');
      await loadProperties();
      await refreshStats();
      // Clear form
      ['prop-address','prop-price-monthly','prop-bedrooms','prop-bathrooms','prop-notes']
        .forEach(id => document.getElementById(id).value = '');
    }
  }

  // â”€â”€ Delete client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function deleteClient(id, name) {
    if (!confirm(`Remove ${name} from your client list?`)) return;
    await fetch(`/api/clients/${id}`, { method: 'DELETE' });
    document.getElementById(`client-row-${id}`)?.remove();
    refreshStats();
  }

  // â”€â”€ Signature toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleSig() {
    const track = document.getElementById('sig-track');
    const wrap  = document.getElementById('sig-editor-wrap');
    const label = document.getElementById('sig-toggle-label');
    const on    = !track.classList.contains('on');
    track.classList.toggle('on', on);
    wrap.style.display  = on ? 'block' : 'none';
    label.textContent   = on ? 'On' : 'Off';
  }

  function setSigToggle(enabled) {
    const track = document.getElementById('sig-track');
    const wrap  = document.getElementById('sig-editor-wrap');
    const label = document.getElementById('sig-toggle-label');
    track.classList.toggle('on', enabled);
    wrap.style.display = enabled ? 'block' : 'none';
    label.textContent  = enabled ? 'On' : 'Off';
  }

  // â”€â”€ Signature editor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function sigFmt(cmd, val) {
    document.getElementById('sig-editor').focus();
    document.execCommand(cmd, false, val || null);
  }

  // â”€â”€ Agent Profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function openProfileModal() {
    const r = await fetch('/api/profile');
    const p = await r.json();
    document.getElementById('profile-name').value    = p.agent_name    || '';
    document.getElementById('profile-company').value = p.agent_company || '';
    document.getElementById('profile-tone').value    = p.agent_tone    || 'professional and warm';
    // Signature: stored as HTML, render in contenteditable
    document.getElementById('sig-editor').innerHTML = p.agent_signature || '';
    setSigToggle(p.agent_signature_enabled === 'true');
    openModal('profile-modal');
  }

  async function saveProfile() {
    const sigEnabled = document.getElementById('sig-track').classList.contains('on');
    const body = {
      agent_name:             document.getElementById('profile-name').value.trim(),
      agent_company:          document.getElementById('profile-company').value.trim(),
      agent_tone:             document.getElementById('profile-tone').value,
      agent_signature:        document.getElementById('sig-editor').innerHTML.trim(),
      agent_signature_enabled: String(sigEnabled),
    };
    if (!body.agent_name) { alert('Name is required.'); return; }
    await fetch('/api/profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });
    closeModal('profile-modal');
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('header-date').textContent = new Date().toLocaleDateString('en-US', {
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
  });

  refreshAll();
  loadLeads(); // preload for dashboard recent leads
  setPollDisplay();
  buildSwatches();
  setInterval(refreshAll, 30000);
</script>
</body>
</html>
